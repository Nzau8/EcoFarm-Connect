{% extends 'connect/base.html' %}
{% block content %}
<div class="container mt-4">
  <h3>Order Delivery Tracking</h3>
  <p>Track the delivery status of your order in real-time.</p>

  <!-- Order Details -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white">
      Order #{{ order.id }}
    </div>
    <div class="card-body">
      <p><strong>Product:</strong> {{ order.product.name }}</p>
      <p><strong>Buyer:</strong> {{ order.buyer.username }}</p>
      <p><strong>Quantity:</strong> {{ order.quantity }}</p>
      <p><strong>Total Price:</strong> ${{ order.total_price }}</p>
      <p><strong>Delivery Address:</strong> {{ order.delivery_address }}</p>
    </div>
  </div>

  <!-- Delivery Status -->
  <div class="card mb-4">
    <div class="card-header bg-warning text-dark">
      Delivery Status
    </div>
    <div class="card-body">
      <div class="progress">
        <div class="progress-bar {{ order.get_progress_class }}" role="progressbar" 
             style="width: {{ order.get_progress_percentage }}%" 
             aria-valuenow="{{ order.get_progress_percentage }}" 
             aria-valuemin="0" aria-valuemax="100">
          {{ order.delivery_status }}
        </div>
      </div>
      
      <div class="mt-3">
        <p><strong>Current Status:</strong> {{ order.get_delivery_status_display }}</p>
        {% if order.assigned_rider %}
          <p><strong>Rider:</strong> {{ order.assigned_rider.user.username }}</p>
          <p><strong>Rider Contact:</strong> {{ order.assigned_rider.phone_number }}</p>
          <a href="{% url 'connect:chat_with_rider' order.id %}" class="btn btn-success">
            Chat with Rider
          </a>
        {% else %}
          <p>A rider will be assigned to your delivery soon.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="text-center">
    <a href="{% url 'connect:order_details' order.id %}" class="btn btn-outline-success">
      Back to Order Details
    </a>
  </div>
</div>
{% endblock %}
